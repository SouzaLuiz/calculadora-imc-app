workflows:
    react-native-android:
        name: React Native Android
        max_build_duration: 120
        instance_type: mac_mini
        environment:
            vars:
                PACKAGE_NAME: "com.calculatorimc"
                CM_KEYSTORE: Encrypted(Z0FBQUFBQmdyX3ZqS2xjX3N5NFZxZXhheWt2RHhCRHNKT3pPdTZYQV8xZDBTUE1JMmR0UHhVWGMtNjF0S0M2SGF1RW1VeHJxWHZfMGM3a1NEUWd4eEtRcWFxLU04dldselBPbVRPekdnZXlyR051dG5saW9mSWdMTm9DMGNReDJfRDVpQmxKS2hpd1NHaFA1bXZRU0pnbm1QQUNEdzhVc01rbFc0VmF4VHRNcXdxalVqWU1zMVJVQU9YT1hqQkJKSXZRSk5hNWFNMi1DOFc0NnR1ajJpcVoycXM0SWNuOGNScHQ2ZjJSQ3hBUEhQMFZuQjRubXBHYThJSEdxSmNKaDQyQXE0SExyYmtSTzEzRkEtcjBDTE1RT1ZVbzdZRzBFeXFSRlQ3Y1BtMzliRUI5M3dKb05Jblg3RnZlbTdkZzkzcUJjcGtZekpWZzhNbVh6b0xEVG1YMGZIOXlxNF9adXlhMHllQllaYzlOaV9GOEEzOHpqUkthRHlaMGRrVnJtbzE4Q2RSeTZCeWFvSzBvcHNjRUE4TW91Skk4dG13YjVmQnFuRUtONEs1UEpzMWF6MXVaR0JRalBXS09sWDkwSmdFUkhnRmkyc3U4RnZPbGRZTFpIcXNjZEQ2SWVLcnV4UXF0Qlp1dnJaczlkY2kyaXB6dDRsZ2JfdDB2dXUyNVZlTWdQbkZjZHIzOUtnSDc3amd3dlRkajg1TFdzS2dGUkNpRVE0R0hTb3BIZG9udE9JWS1TaVJMZGdXeDIxeDVXc2FvdTVoazBDN0pkNnpUUHNkNmZRUVlTQWQ2MzdxT24ya0R3eGtfOFpKNlJCTUZ1UmVCd09BbFEzSzk4ZG9hM1BxUEh5dElUWlJuQXlUOGdsQ0d2OHV6UHBmaENaVFNDU3lFY2FVbm9ZaHJ0VTk2czk1Y05Tbm5zRGhVc1U3clFJbUNrWFFWSkxtTVlYaGxkMDA4T0NxMXdtRkFfaC1yM2tFSTRtUXFza1hQS1BTV2VBeFFoZE1kR3VqMVltalFnbzFOSHNJTWhBYlVrd2o3SF9GZloyR0JORzlFcHVHd2dOSG1WczJzQ3czenVuXzVCeTVHN2IzOW45SWFHZVR2SGhMOGhqNDNFcXVxUm5ib29PZ0pLa20yaHIwS2pLMDB0U3lERUJLenM4djVIbW9ETHUyTlZVY1dFbDdJZ2lGUGlIbGVsQ3hPVncwb01aOW51RXlnaUpZdWZFN0lRd3JoUlJnZ19sWWViRVRvMWE1eEc5RVJyMDdicXppNXgzU184dm1mSHlCUjdwYVBPbUw3dEx6MlBjU2cxSlFQeDhycTdaSnF5dW94cjFRdDFiMFhSa2VGQ1NBOU9MaW1IUlJXLU16M1VkVWowdkVtdS01eE15emN5Q0kwc1k4Sm1idFBtR29sdk1KeDQyUFlpZXBWNE1ieXFSS3dYeERHb2NzOVFCejg3SGl1cmdySGlua3dKU2o0YzV4N1VsSWppR05CWmhraUktNVJHLTBBS1ZnRHZXa0lIV3pQaDl4a0gtejdyM2s4Um1GNmtOcWdtQWUxeV9fdThvVFJjOGNBX0NENUlGVUw2VVF5bWZQbDE3SXJhNHVzSFVxOWdmZ2p3QTNjeVkxdXI5UzRPTjRhMV9DVldtRk14ZkxxaldpV2xoZktpWV9mcDMySGNUa3R6cHBkY0pMVnVWN21JMEE2c3J0c1BpWjJCUWRvZVpKR29uZXVublVTNmphRG9ObGhsVUpUeWRTdXZuc081WHBPNlZIeG9QcnN2cjNUMm9oSnlwRXozTWYteFp4cE9oYXJXWE9Md084dS1mSG1Ybng5TVRIYnJyQjRJV000NnBqY0FHTWNhcEplMXZJR0RBcDlIRnI5NHFwNXFIbjJXeGEySkQzclc2cmNudGZSV2RlTnR1Y3lOcEE4NWFjcTY4Tld5Ry0tMWw1NkRwS1Z5UXgxS0t3QU9XSVFjU28wWDJSMlFLQkVwM3UxckZsUF9DX2tyTVBFSTRIajhQbVFrQ3AycExxWkxaVUhXc0VxS054NW9pWjZjTmVWcThidlVGN2hfcWRVM2VjQ0lPTzV4QTROUzJ0QXZzdlo4OEVTSEdHamc2Qmp2UFI5TG1HSVZBV0xFMzRsYUc4UkppWmJyTWN0VjZIZ0ZoOVJlQi1MZFVvYlpoYUZEVzBlcGduUWNRclAzTFN2N2VISzhycFFKbmIwemtMN0l3aXVZTHZOS0tTeGhNZXBwdEpVbnNoa1dIOE5sYWxZaEZ3S0ZudVlkZ2REbFlpZ0NKNmpZRHowRlQ5Zzh3Vi03ekhFUkJYYjIxNWNyZy1zUW5hTVY1c1ZudmI0a0MwQ1ljSjJkaVAtRjVPcHhGdjJDOWxSUXZKRk5Na24yRkRtSnRlS3p4U3dmYjRPMW9DaHBhQ2tudnNVTElrUEZkd3lpUml0bm5QeXo1c19TTThXSXY0bmNwTE1qVFRSZXllNHNDa1VVUDhCaTRvSXJXcGRYY0xjR182UnA0Y3E4RHg0NEJpdHF3dFdmWTR2ZWlaam9GUnZvdlZTam5wRlRaaHpmSlpXXzd0OVlXV05VSzJ2djhKeGRoMWNDWFZ6ck1lNGdrbE94LWV4QVZ1VEZQQXowVXNsNE96NGx0QlpseVpkNnJGaGdvQnl6TnlKUm5HSXJqSGZscXJvVWhKeTdySlZZTEJiZk5BaGkzeW8wdHZ5cFJNVkRrWEdmbzJhUk4xcE9mZ1ZPVDFBR3JneGNySDViZUFWYi0wMHI1SVhEVTRMaHdLelBBVFBROUhxWjNxcFVHdEJNekNuYjZwdUhlMjZsQXc2WlQxWFNETzVReGlwSmhvek1KdGtFU1JYcXRwX2lmRTlrNFQtRmNBQmx6UnNDd3AybzE3V0V4SUdwWms3alY5X0VuanVFNTJvcVV1bTZBSU8tTmxGQXp3WkFCNGtRLTYtNENjejkwRThWTEFoMDAxeVRhZURQdlRRakpZT1lhZmt0UnRUQ1hWSUhVMVhGZnBZRVJ2bGxNNi1Cc2pTMjdGOVM2ZW9CM21ZbFgzX2hzNkZrUjRfY2F5dzdJZFBRSWsyOVV4c1BlQmVjenE5TzMzcjBSaTNQeFpyS0lZOWltUDlES3hINE90anNjYnI1cS1qTFhSbjRCdFgxa0wyVFNoUERISnlDNlhTeTBGTGczbENXZUs1RXBmZ29UR0RGWmxjQUFYUkhnc0g5eElkNnV6ZHE1aGEzWXdMTm9CaUZMWHowRUZCa19JQ1c0Y203emVJSXpoUkVMek80cHVzNUdmZlIzekJhdElFVDU1UWtXdkY2LXQwT0xjejRkZVpUMy1uSFlMWWNmX0VMNWhWcnkxX000Z3NiX0RVeDZkZExrS0FFb255dW5jc2ZweWVDS0g1aDN1MkRPYTNjblBWSHdoOV9wb2dJRWRsbUY5d2F6VmlHOUM0Mkp4b2tsQnNZcXRCekdOZFZuYlBHdmIxQkx4UEZaczBqaGk5Q2hyUkxmTjJZS0hKb0tpS0wtQV9LampmbVI1MlNzQTl6VTFfQnF3bUFRTXg4aHJXWWxkMkxHOFlzcng4UDQ0N2p4LXNhZDZ2a0hxSWNqQjFOMU50T1pVcHp3MzlzczhvWU1lU2RrdmQ1Q24tSlNHekhpMElHOTV6TFQzbzhLQ2xDTGFVUFRHR1NPR21wRmliRFZpSmt3bUxnR1ViZ3puYU0yZ3RKbF9YWGpkTGM4TkFxZURMVFlrTUJ5VV9QSzBrM3NXcUY0YVFJSFNmSUdpb29qVmRYcXRxYXRpTms4bUh3dkhqMFJiZmJzVXRSQXNBWjBSUDloM3ZNN2xhQ3Bkak5INzg2dEQxa0xHd1ZHT3Nva0EwZjNCT1d3QjVwVExURmF3akNkNkFLdy1yQ0tkWklCVmEwQjhaRHZ5d1MxRS13NEtCS2hGRzljWFJnSEhIOHNKTUxJQjhkazMyNG84ZEctWFJIMDlvNDl1ay1fLUdTRE9XX0dzdzFMUmdmdGM2ajR1RGFmemxtWGdrSGRLcHBJQ2tmcDd4MENVN1d2aVFMRzdobG1Jc2xVWG53WXJXOGxROTlnbzlxbFhkc2tnU0o3UGhZaUVxRVBxcWxrQk95M2hGd09GNVdVMFJvVWVwQUNHNU9UV3dtMDRMVXhjYjhHMjVfdWNfV2g5aWxzVk8xUnMyVm1ycnlJR3BvSjl1eUNfdG9rZklGbks1QVRsZGI2b3V3T0RVYndXUGRlV195cWMxNlNwOXJRd29ld0Rhb09rcE1xWEZwOXJPSnpYc05tNEo0alFjRnhrbmxwRDRVOElGRTRHSUp5bVZqSXZrTkRLaHZjbDhuVWJCZFRSWkNpZWl1MDNVQlJOYnVnMlpWQkFJdjlzaXBzMnhHcmNYa1RaMmxNV0w2UkRtX3Y4OFkyOHB4UGU1OVo0RnpyN3lmZ28xcnl1dWJmMlM4S0xEX3A3U3l6N3NmVDIzbUlHRmsyY1pRWWlhc3dLanBNMWVTZjYySTBXelpRb3lNYmVmcG5pd010ZEVJSnFHMms0YWpwZzRUTHN1S0FiVEhxdUEzcmhmdTNFWUliNXZuNEpVVXpzNmh4emhHUkJhMGk4OXZEN2pBNzRtVmREN0lyS0d6UTBTejF3WEpjYmxGS0hrQ1JhQ1VmV1NBSHA3SlFZY3VKT3R0UGxtc0w0Qmk1R1FsTlk3YzRzeVdQUVc1UUdsUml6TWxobW5VYml2TV8yZWhZY0dVQnNCZnN3RjZrUzBxQnBXRm9Jckg5RXpiU2RmMGRFZjA3Tm53VGU4RU1xcV9JdkFLRjZuUTdZc0ZISFEtTVJTdDU1Tnk4X0hfTnFiRFR2ZkdUZi1XZU9sc0tmdG9Zend1bldocC1EcWxsXzBRZW1IQTNIZ0ExVy1YalpYc1RfN0xXa1ZyRmFackFUSUkzengtMmh2N284bXZrVlhUSUpPaTZfcVQxbmpPOEpCUEFGWTdkMmJnMlBsQ1ZZLXMzVExiLXp0eWhCcFFNZGp1Um54eTIzeDRFRWtuX0lIVjJERUdkLVlpTkU0Vi1FVS1BbjN0TEozWEFJU3p0UGJKQ3ZfNHhuRjhqVVlqcmZOVjUzVlBHdXV0dl8telhRa0dvUlF6R0J3c184UkJ0a18yUlp0M1hwaE5SSDF1bkhFSDNQLVQxaEg4ZmVZa1pvbGNyQUVBNUpIaVpsQllHTmVGWGFWYlphaWI1c2xQUFlzMEd5dF92eURBZGlvWmNZZlpxRTNxTldIWGpaV2oxZGVONlJIN2ZfM3Y1XzcxSV80MjE5c0FsczNBSGJvbE11RUNBN3FjU25fOExwY09qXzhKc1hrUUdzcW1wZGVPbjI5dThESzIzOEZPeGZHdXN4a0xOeFllX09lZFBabExqQUk0aWttVEZYSEhOYl9wUDZva01VMm5GM29uaUFoaGNUelhrckRJOGloSUtBTVVlT2h5aHpXalRDbkc3RDE0aUJ3UnE1QlFiMmhHZkxmX080VWRyd0stQzJoUUk5aVVmYzl5UzZRSWxJZ0k3ckpqSU9CbTVUWlRxWWtHT3VTbnQ4aXplVmdlOUVJdlk0c3pYUW5hRzlzd194VEVNeDU4bnRXbl9YMUwzaEFRam53Zk4yVFQ3eTZVakdyYXZkWERtWE13U1pRQzdjX3EtdE5WYUdRNkpqOXF2YzBoRHhaVFpyd1JDa0hnRHUxanBJcVRZRk1Pc3k1MjZRbUM5T0F2ekxZOGFHaFl6RU8yZUtRMUZOaE5pbGZSdTFQbWhRY3U0aE1ySVBpeGhBRlZCWC1PM2Z1OVdpbURqWGRzQUlWaXdhbTBYcU5LY2NyRkJLODkzZy0yY0Fka1RjajR2SS1GUzU5WFZjeld5RnFZazlJUWR3b2MyN0l3YXZEcEFFWnFzN2NQbDNaQzJfMkFTZTZETHY3NURhckZidkhlZFNybDdReUh0QWp6eGRUOW5Wc3d4cTd1bVJuZHVLa2R0NUs0aGdSX0lfSXZWRVhhVVBmTGtHbU5WS2RSSlpkalo3ZGVuMEw5bWl6Vjh1cVpWQnVLRFdBTjl0OHFrdmNGb0NycEFMODhhQ0pwQTBUZnkyUFVNU0V5TDhGQzZiSUNVWlg1R0U3VHFUNEpuTUhlSjFRU1F0dXhCNEpDUnEyMFVMVmhzLWdtd2ZwMklWOVA4REkwWVdxVjB1MTFkNHh5TlJ0Tlh1SEZacXFPekhINmxYN0hhczEzbkhxNTRFaE41VUhZUTBfUE4tMzRjYWRFNkd5QWZyRTZDX0o0cHJsOEJ0MmxrLXpXbzZTaUVBcW81ekRSY19xUHF2VnVaeG5oZXQ4SW5Hamg=)
                CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmdyX3hvVWJfWFNlcUVNY0lxejJfSlZmUWIybW01SUtqNmctVFM5S2owTFJnejdRaTd2RENUbzV1c2JxVnIzdnJ2dXg0ZXFlV01EM2NhZ2pHRTQzam9EOTliTkE9PQ==)
                CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmdyX3hvVWJfWFNlcUVNY0lxejJfSlZmUWIybW01SUtqNmctVFM5S2owTFJnejdRaTd2RENUbzV1c2JxVnIzdnJ2dXg0ZXFlV01EM2NhZ2pHRTQzam9EOTliTkE9PQ==)
                CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmdyX3labHFYcVZxNE0xRGI4TzNnbFdPcXpuWWw4OVBpYkdKbVhVX0I3cmdwWF9nZkxmN1pUUlR5ckgwb1RPRVdrYjc0UGxFZzhwcVZ0azVRQTczeW9ZUjR2bUE9PQ==)
            node: latest
        scripts:
            - name: Install dependencies
              script: |
                                yarn install
            - name: Set Android SDK location
              script: |
                                echo "sdk.dir=$ANDROID_SDK_ROOT" > "$FCI_BUILD_DIR/android/local.properties"
            - name: Set up keystore
              script: |
                    echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
                    cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
                    storePassword=$CM_KEYSTORE_PASSWORD
                    keyPassword=$CM_KEY_ALIAS_PASSWORD
                    keyAlias=$CM_KEY_ALIAS_USERNAME
                    storeFile=/tmp/keystore.keystore
                    EOF                                   
            - name: Build Android release
              script: |
                # Set environment variable so it can be used to increment build number in android/app/build.gradle
                # Note that tracks can be specified when retrieving latest build number from Google Play, for example:
                # export NEW_BUILD_NUMBER=$(($(google-play get-latest-build-number --package-name "$PACKAGE_NAME" --tracks=alpha) + 1))
                export NEW_BUILD_NUMBER=$(($(google-play get-latest-build-number --package-name "$PACKAGE_NAME") + 1))
                cd android && ./gradlew assembleRelease                
        artifacts:
            - android/app/build/outputs/**/*.apk
